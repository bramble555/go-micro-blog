{{ define "content" }}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        background-color: #f9fafb;
    }

    .article-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 24px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
    }

    .article-card:hover {
        transform: translateY(-4px);
        border-color: #3b82f6;
        box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.1);
    }

    .detail-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 48px;
        border-radius: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
    }

    .detail-title {
        font-size: 2.25rem;
        font-weight: 800;
        color: #111827;
        line-height: 1.2;
        margin-bottom: 1.5rem;
    }

    .detail-meta {
        display: flex;
        align-items: center;
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #f3f4f6;
    }

    .detail-body {
        font-size: 1.125rem;
        line-height: 1.8;
        color: #374151;
        white-space: pre-wrap;
        word-break: break-word;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        color: #3b82f6;
        font-weight: 600;
        margin-bottom: 2rem;
        transition: transform 0.2s;
        cursor: pointer;
    }

    .back-link:hover {
        transform: translateX(-4px);
    }
</style>

<div class="container mx-auto py-12" style="max-width: 1000px; margin: 0 auto; padding: 0 20px;">
    <div id="list-view">
        <div style="margin-bottom: 40px; display: flex; justify-content: space-between; align-items: center;">
            <h1 style="font-size: 32px; font-weight: 800; color: #111827; letter-spacing: -0.025em;">æœ€æ–°æ–‡ç« </h1>
            <div id="auth-zone" style="display: flex; gap: 12px;">
                <a href="/admin/login"
                    style="background-color: #1f2937; color: white; padding: 10px 24px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 14px;">
                    ç®¡ç†å‘˜ç™»å½•
                </a>
            </div>
        </div>
        <div id="article-list" style="display: grid; grid-template-columns: 1fr; gap: 24px;">
            <div style="text-align: center; padding: 100px 0; color: #9ca3af;">
                <p>æ­£åœ¨æ‹‰å–æœ€æ–°å†…å®¹...</p>
            </div>
        </div>
    </div>

    <div id="detail-view" style="display: none;">
        <div class="back-link" onclick="handleBackToList()">
            <svg style="width: 20px; height: 20px; margin-right: 8px;" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18">
                </path>
            </svg>
            è¿”å›åˆ—è¡¨
        </div>

        <article class="detail-container">
            <h1 id="detail-title" class="detail-title"></h1>
            <div class="detail-meta">
                <span id="detail-date"></span>
                <span style="margin: 0 12px; color: #d1d5db;">|</span>
                <span>é˜…è¯»æ—¶é•¿çº¦ 3 åˆ†é’Ÿ</span>
            </div>
            <div id="detail-content" class="detail-body"></div>
        </article>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const token = localStorage.getItem('token');
        const authZone = document.getElementById('auth-zone');
        if (token && authZone) {
            authZone.innerHTML = `
                <a href="/admin/create" style="background-color: #10b981; color: white; padding: 10px 24px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 14px;">+ å‘å¸ƒæ–°æ–‡ç« </a>
                <button onclick="logout()" style="background-color: #ef4444; color: white; padding: 10px 24px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; font-size: 14px;">é€€å‡º</button>
            `;
        }
        loadArticles();

        // ğŸš€ å¤„ç†æµè§ˆå™¨å‰è¿›/åé€€
        window.onpopstate = function (event) {
            if (event.state && event.state.articleId) {
                renderDetailContent(event.state.articleId, false);
            } else {
                renderListView(false);
            }
        };
    });

    async function loadArticles() {
        const articleList = document.getElementById('article-list');
        try {
            const res = await fetch('/api/articles');
            const result = await res.json();
            if (result.code === 200 && result.data) {
                articleList.innerHTML = '';
                result.data.forEach(post => {
                    const postDate = post.created_at ? post.created_at.substring(0, 10) : '2025-12-24';
                    articleList.innerHTML += `
                        <div class="article-card" onclick="showDetail('${post.id}')">
                            <h2 style="font-size: 22px; font-weight: 700; color: #111827; margin-bottom: 12px;">${post.title}</h2>
                            <p style="color: #4b5563; line-height: 1.6; margin-bottom: 16px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${post.summary}</p>
                            <div style="display: flex; align-items: center; font-size: 13px; color: #9ca3af;">
                                <svg style="width: 14px; height: 14px; margin-right: 4px;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                ${postDate}
                            </div>
                        </div>
                    `;
                });
            }
        } catch (err) { console.error(err); }
    }

    // ğŸš€ å…¥å£å‡½æ•°ï¼šæ˜¾ç¤ºè¯¦æƒ…å¹¶æ¨é€ URL
    function showDetail(id) {
        renderDetailContent(id, true);
    }

    // ğŸš€ æ ¸å¿ƒæ¸²æŸ“å‡½æ•°
    async function renderDetailContent(id, pushState) {
        try {
            const res = await fetch(`/api/articles/${id}`);
            const result = await res.json();
            if (result.code === 200) {
                document.getElementById('list-view').style.display = 'none';
                document.getElementById('detail-view').style.display = 'block';

                document.getElementById('detail-title').innerText = result.data.title;
                document.getElementById('detail-date').innerText = "å‘å¸ƒäº " + (result.data.created_at ? result.data.created_at.substring(0, 10) : "");
                document.getElementById('detail-content').innerText = result.data.content;

                // æ¨é€ URL
                if (pushState) {
                    window.history.pushState({ articleId: id }, "", `/article/${id}`);
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        } catch (err) { alert("åŠ è½½å¤±è´¥"); }
    }

    // ğŸš€ å¤„ç†è¿”å›æŒ‰é’®
    function handleBackToList() {
        renderListView(true);
    }

    function renderListView(pushState) {
        document.getElementById('list-view').style.display = 'block';
        document.getElementById('detail-view').style.display = 'none';
        if (pushState) {
            window.history.pushState({}, "", "/");
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/';
    }
</script>
{{ end }}