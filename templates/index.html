{{ define "content" }}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f9fafb;
    }

    .article-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 16px;
        padding: 24px;
        transition: all 0.3s;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .article-card:hover {
        transform: translateY(-4px);
        border-color: #3b82f6;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .detail-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 24px;
        border: 1px solid #f3f4f6;
    }

    .detail-body {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #374151;
        white-space: pre-wrap;
        margin-bottom: 40px;
    }

    .comment-box {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid #f3f4f6;
    }

    .comment-item {
        padding: 15px 0;
        border-bottom: 1px solid #f9fafb;
    }

    .comment-user {
        font-weight: 700;
        color: #111827;
        font-size: 14px;
    }

    .comment-text {
        color: #4b5563;
        margin-top: 5px;
        font-size: 15px;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        color: #3b82f6;
        cursor: pointer;
        font-weight: 600;
        margin-bottom: 20px;
    }
</style>

<div class="container mx-auto py-12" style="max-width: 900px; margin: 0 auto; padding: 0 20px;">
    <div id="list-view">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
            <h1 style="font-size: 32px; font-weight: 800;">æœ€æ–°æ–‡ç« </h1>
            <div id="auth-zone">
                <a href="/admin/login"
                    style="background: #1f2937; color: white; padding: 10px 20px; border-radius: 10px; text-decoration: none;">ç®¡ç†å‘˜ç™»å½•</a>
            </div>
        </div>
        <div id="article-list">åŠ è½½ä¸­...</div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        // 1. å°è¯•ä½¿ç”¨æœåŠ¡ç«¯éªŒè¯çš„ /api/me æ¥åˆ¤æ–­æ˜¯å¦ç®¡ç†å‘˜
        const token = localStorage.getItem('token');
        let isAdmin = false;
        if (token) {
            try {
                const res = await fetch('/api/me', { headers: { 'Authorization': 'Bearer ' + token } });
                if (res.ok) {
                    const data = await res.json();
                    if (data.code === 200 && data.data && data.data.roles && data.data.roles.indexOf('admin') !== -1) {
                        isAdmin = true;
                    }
                }
            } catch (e) { /* ignore */ }
        }

        if (isAdmin) {
            document.getElementById('auth-zone').innerHTML = `
                <a href="/admin/create" style="background:#10b981; color:white; padding:10px 20px; border-radius:10px; text-decoration:none; margin-right:10px;">+ æ–°æ–‡ç« </a>
                <button onclick="logout()" style="background:#ef4444; color:white; padding:10px 20px; border-radius:10px; border:none; cursor:pointer;">é€€å‡º</button>
            `;
        }

        // 2. åŠ è½½æ–‡ç« åˆ—è¡¨
        loadArticles();
    });

    async function loadArticles() {
        try {
            const res = await fetch('/api/articles');
            const result = await res.json();
            const list = document.getElementById('article-list');
            list.innerHTML = '';
            result.data.forEach(post => {
                list.innerHTML += `
                    <div class="article-card" onclick="showDetail('${post.id}')">
                        <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">${post.title}</h2>
                        <p style="color: #6b7280; margin-bottom: 12px;">${(post.content || '').substring(0, 100)}...</p>
                        <span style="font-size: 13px; color: #9ca3af;">ğŸ“… ${post.created_at.substring(0, 10)}</span>
                    </div>
                `;
            });
        } catch (err) { console.error(err); }
    }

    function showDetail(id) {
        // å¯¼èˆªåˆ°æ–‡ç« è¯¦æƒ…é¡µé¢ï¼ˆç”±åç«¯æ¸²æŸ“ post.htmlï¼‰
        window.location.href = `/api/articles/${id}`;
    }

    function logout() { 
        localStorage.removeItem('token'); 
        window.location.href = '/'; 
    }
</script>
{{ end }}